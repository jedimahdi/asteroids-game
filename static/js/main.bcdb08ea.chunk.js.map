{"version":3,"sources":["utils/base.js","objects/ship.js","objects/bullet.js","App.js","utils/helpers.js","index.js"],"names":["mod","x","y","id","nextPosition","state","screen","width","ship","position","velocity","height","nextRotation","keys","right","rotation","left","nextVelocity","up","Math","sin","PI","cos","update","bullet","initialState","context","lastShot","bullets","ratio","reducer","action","type","posDelta","p","center","angle","newBullet","Date","now","save","translate","rotate","strokeStyle","fillStyle","lineWidth","beginPath","moveTo","lineTo","closePath","fill","stroke","restore","Ship","map","arc","Bullet","filter","KEY","App","canvas","useRef","useReducer","dispatch","useEffect","ctx","current","getContext","window","innerWidth","innerHeight","devicePixelRatio","useCallback","fillRect","requestAnimationFrame","handleKeys","e","value","keyCode","addEventListener","removeEventListener","className","ref","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.bcdb08ea.chunk.js","sourcesContent":["export const mod = x => y => ((y % x) + x) % x\n\nexport const rnd = min => max => Math.floor(Math.random() * max) + min\n\nexport const id = x => x\n","import {mod} from '../utils/base'\n\nconst ROTATION_SPEED = 2\nconst SHIP_SPEED = 0.1\nconst INERTIA = 0.99\n\nconst nextPosition = state => ({\n  x: mod(state.screen.width)(state.ship.position.x + state.ship.velocity.x),\n  y: mod(state.screen.height)(state.ship.position.y + state.ship.velocity.y),\n})\n\nconst nextRotation = state =>\n  state.keys.right\n    ? mod(360)(state.ship.rotation + ROTATION_SPEED)\n    : state.keys.left\n    ? mod(360)(state.ship.rotation - ROTATION_SPEED)\n    : mod(360)(state.ship.rotation)\n\nconst accelerate = velocity => rotation => ({\n  x:\n    (velocity.x - Math.sin((-rotation * Math.PI) / 180) * SHIP_SPEED) * INERTIA,\n  y:\n    (velocity.y - Math.cos((-rotation * Math.PI) / 180) * SHIP_SPEED) * INERTIA,\n})\n\nconst nextVelocity = state =>\n  state.keys.up\n    ? accelerate(state.ship.velocity)(state.ship.rotation)\n    : {\n        x: state.ship.velocity.x * INERTIA,\n        y: state.ship.velocity.y * INERTIA,\n      }\n\nconst update = state => ({\n  ...state.ship,\n  position: nextPosition(state),\n  velocity: nextVelocity(state),\n  rotation: nextRotation(state),\n})\n\nfunction draw(state) {\n  const {context, ship} = state\n\n  context.save()\n  context.translate(ship.position.x, ship.position.y)\n  context.rotate((ship.rotation * Math.PI) / 180)\n  context.strokeStyle = '#ffffff'\n  context.fillStyle = '#000000'\n  context.lineWidth = 2\n  context.beginPath()\n  context.moveTo(0, -15)\n  context.lineTo(10, 10)\n  context.lineTo(5, 7)\n  context.lineTo(-5, 7)\n  context.lineTo(-10, 10)\n  context.closePath()\n  context.fill()\n  context.stroke()\n  context.restore()\n}\nexport {draw, update}\n","const nextPosition = (state, bullet) => ({\n  x: bullet.position.x + bullet.velocity.x,\n  y: bullet.position.y + bullet.velocity.y,\n})\n\nconst update = (state, bullet) =>\n  bullet.position.x < 0 ||\n  bullet.position.y < 0 ||\n  bullet.position.x > state.screen.width ||\n  bullet.position.y > state.screen.height\n    ? null\n    : {...bullet, position: nextPosition(state, bullet)}\n\nfunction draw(state, bullet) {\n  const {context} = state\n\n  context.save()\n  context.translate(bullet.position.x, bullet.position.y)\n  context.rotate((bullet.rotation * Math.PI) / 180)\n  context.fillStyle = '#FFF'\n  context.lineWidth = 0.5\n  context.beginPath()\n  context.arc(0, 0, 2, 0, 2 * Math.PI)\n  context.closePath()\n  context.fill()\n  context.restore()\n}\n\nexport {draw, update}\n","import React, {useEffect, useRef, useReducer, useCallback} from 'react'\nimport {id} from './utils/base'\nimport {rotatePoint} from './utils/helpers'\nimport * as Ship from './objects/ship'\nimport * as Bullet from './objects/bullet'\n\nconst initialState = {\n  context: null,\n  ship: {\n    position: {\n      x: 800,\n      y: 400,\n    },\n    velocity: {\n      x: 0,\n      y: 0,\n    },\n    rotation: 0,\n  },\n  lastShot: 0,\n  bullets: [],\n  keys: {\n    right: false,\n    left: false,\n    up: false,\n  },\n  screen: {\n    width: 0,\n    height: 0,\n    ratio: 0,\n  },\n}\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'set_context':\n      return {...state, context: action.context, screen: action.screen}\n\n    case 'set_keys':\n      return {...state, keys: {...state.keys, ...action.keys}}\n\n    case 'add_bullet':\n      const posDelta = rotatePoint(\n        {x: 0, y: -20},\n        {x: 0, y: 0},\n        (state.ship.rotation * Math.PI) / 180,\n      )\n\n      const newBullet = {\n        position: {\n          x: state.ship.position.x + posDelta.x,\n          y: state.ship.position.y + posDelta.y,\n        },\n        velocity: {\n          x: posDelta.x / 2,\n          y: posDelta.y / 2,\n        },\n      }\n\n      return Date.now() - state.lastShot > 300\n        ? {\n            ...state,\n            lastShot: Date.now(),\n            bullets: [...state.bullets, newBullet],\n          }\n        : state\n\n    case 'update':\n      Ship.draw(state)\n      const drawBullet = (x) => Bullet.draw(state, x)\n      const updateBullet = (x) => Bullet.update(state, x)\n      state.bullets.map(drawBullet)\n\n      return {\n        ...state,\n        ship: Ship.update(state),\n        bullets: state.bullets.map(updateBullet).filter(id),\n      }\n\n    default:\n      return state\n  }\n}\n\nconst KEY = {\n  LEFT: 37,\n  RIGHT: 39,\n  UP: 38,\n  A: 65,\n  D: 68,\n  W: 87,\n  SPACE: 32,\n}\n\nfunction App() {\n  const canvas = useRef(null)\n  const [state, dispatch] = useReducer(reducer, initialState)\n\n  useEffect(() => {\n    const ctx = canvas.current.getContext('2d')\n    dispatch({\n      type: 'set_context',\n      context: ctx,\n      screen: {\n        width: window.innerWidth,\n        height: window.innerHeight,\n        ratio: window.devicePixelRatio || 1,\n      },\n    })\n  }, [])\n\n  const update = useCallback(() => {\n    let ctx = state.context || canvas.current.getContext('2d')\n\n    ctx.save()\n\n    ctx.fillStyle = '#000'\n    // context.globalAlpha = 0.4;\n    ctx.fillRect(0, 0, window.innerWidth, window.innerHeight)\n\n    dispatch({type: 'update'})\n\n    ctx.restore()\n    requestAnimationFrame(() => {\n      update()\n    })\n  }, [state.context])\n\n  const handleKeys = useCallback((e, value) => {\n    if (e.keyCode === KEY.LEFT || e.keyCode === KEY.A)\n      dispatch({type: 'set_keys', keys: {left: value}})\n    if (e.keyCode === KEY.RIGHT || e.keyCode === KEY.D)\n      dispatch({type: 'set_keys', keys: {right: value}})\n    if (e.keyCode === KEY.UP || e.keyCode === KEY.W)\n      dispatch({type: 'set_keys', keys: {up: value}})\n    if (e.keyCode === KEY.SPACE) dispatch({type: 'add_bullet'})\n  }, [])\n\n  useEffect(() => {\n    window.addEventListener('keyup', (e) => handleKeys(e, false))\n    window.addEventListener('keydown', (e) => handleKeys(e, true))\n\n    requestAnimationFrame(() => {\n      update()\n    })\n\n    return () => {\n      window.removeEventListener('keyup', handleKeys)\n      window.removeEventListener('keydown', handleKeys)\n    }\n  }, [handleKeys, update])\n\n  return (\n    <div className=\"App\">\n      <canvas\n        ref={canvas}\n        width={state.screen.width * state.screen.ratio}\n        height={state.screen.height * state.screen.ratio}\n      ></canvas>\n    </div>\n  )\n}\n\nexport default App\n","export function rotatePoint(p, center, angle) {\n  return {\n    x:\n      (p.x - center.x) * Math.cos(angle) -\n      (p.y - center.y) * Math.sin(angle) +\n      center.x,\n    y:\n      (p.x - center.x) * Math.sin(angle) +\n      (p.y - center.y) * Math.cos(angle) +\n      center.y,\n  }\n}\nexport function asteroidVertices(count, rad) {\n  let p = []\n  for (let i = 0; i < count; i++) {\n    p[i] = {\n      x:\n        (-Math.sin(((360 / count) * i * Math.PI) / 180) +\n          (Math.round(Math.random() * 2 - 1) * Math.random()) / 3) *\n        rad,\n      y:\n        (-Math.cos(((360 / count) * i * Math.PI) / 180) +\n          (Math.round(Math.random() * 2 - 1) * Math.random()) / 3) *\n        rad,\n    }\n  }\n  return p\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\nimport './index.css'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n)\n"],"sourceRoot":""}